<!--pages/question/practice/practice.wxml-->
<view class="container">
  <view class="practice-container" wx:if="{{currentQuestion}}">
    <!-- 进度条 -->
    <view class="progress-bar">
      <view class="progress-info">
        <text>{{currentIndex + 1}} / {{totalQuestions}}</text>
      </view>
      <view class="progress-line">
        <view class="progress-fill" style="width: {{((currentIndex + 1) / totalQuestions * 100)}}%"></view>
      </view>
    </view>

    <!-- 题目卡片 -->
    <view class="question-card card">
      <!-- 题目头部 -->
      <view class="question-header">
        <text class="question-type type-{{currentQuestion.type}}">
          {{currentQuestion.type === 'SINGLE_CHOICE' ? '单选题' : currentQuestion.type === 'MULTIPLE_CHOICE' ? '多选题' : currentQuestion.type === 'TRUE_FALSE' ? '判断题' : '简答题'}}
        </text>
        <text class="question-score">{{currentQuestion.score || 5}}分</text>
      </view>

      <!-- 题目内容 -->
      <view class="question-content">
        <text class="question-number">{{currentIndex + 1}}. </text>
        <text class="question-text">{{currentQuestion.content}}</text>
      </view>

      <!-- 选项列表 (选择题/判断题) -->
      <view class="options-list" wx:if="{{currentQuestion.type !== 'SHORT_ANSWER'}}">
        <view class="option-item {{selectedAnswer === item.key ? 'selected' : ''}} {{showAnswer ? (item.key === currentQuestion.correctAnswer ? 'correct' : (selectedAnswer === item.key ? 'wrong' : '')) : ''}}"
              wx:for="{{currentQuestion.options}}"
              wx:key="key"
              data-key="{{item.key}}"
              bindtap="selectOption">
          <view class="option-radio">
            <text wx:if="{{!showAnswer}}">{{item.key}}</text>
            <text wx:if="{{showAnswer && item.key === currentQuestion.correctAnswer}}" class="icon-correct">✓</text>
            <text wx:if="{{showAnswer && selectedAnswer === item.key && item.key !== currentQuestion.correctAnswer}}" class="icon-wrong">✗</text>
          </view>
          <text class="option-text">{{item.value}}</text>
        </view>
      </view>

      <!-- 简答题输入框 -->
      <view class="answer-input-section" wx:if="{{currentQuestion.type === 'SHORT_ANSWER'}}">
        <textarea class="answer-input"
                  placeholder="请输入你的答案..."
                  value="{{answerText}}"
                  bindinput="onAnswerInput"
                  disabled="{{showAnswer}}"
                  maxlength="500">
        </textarea>
        <text class="answer-count">{{answerText.length}}/500</text>
      </view>

      <!-- 答案解析 -->
      <view class="answer-section" wx:if="{{showAnswer}}">
        <view class="answer-header">
          <text class="answer-title">答案解析</text>
        </view>
        <view class="correct-answer">
          <text class="label">正确答案：</text>
          <text class="value">{{currentQuestion.correctAnswer}}</text>
        </view>
        <view class="explanation" wx:if="{{currentQuestion.explanation}}">
          <text class="label">解析：</text>
          <text class="content">{{currentQuestion.explanation}}</text>
        </view>
        <view class="result-badge {{isCorrect ? 'correct' : 'wrong'}}">
          <text>{{isCorrect ? '回答正确 ✓' : '回答错误 ✗'}}</text>
        </view>
      </view>
    </view>

    <!-- 操作按钮 -->
    <view class="action-buttons">
      <button class="btn-submit btn-primary" 
              wx:if="{{!showAnswer}}"
              bindtap="submitAnswer"
              disabled="{{!selectedAnswer && !answerText}}">
        提交答案
      </button>
      
      <view class="btn-group" wx:if="{{showAnswer}}">
        <button class="btn-prev" 
                wx:if="{{currentIndex > 0}}"
                bindtap="prevQuestion">
          上一题
        </button>
        <button class="btn-next btn-primary" 
                wx:if="{{currentIndex < totalQuestions - 1}}"
                bindtap="nextQuestion">
          下一题
        </button>
        <button class="btn-finish btn-success" 
                wx:if="{{currentIndex === totalQuestions - 1}}"
                bindtap="finishPractice">
          完成练习
        </button>
      </view>
    </view>

    <!-- 统计信息 -->
    <view class="stats-info">
      <text class="stats-item">已答：{{answeredCount}}</text>
      <text class="stats-item">正确：{{correctCount}}</text>
      <text class="stats-item">正确率：{{answeredCount > 0 ? Math.round(correctCount / answeredCount * 100) : 0}}%</text>
    </view>
  </view>

  <!-- 加载状态 -->
  <view class="loading" wx:if="{{loading}}">
    <text>加载中...</text>
  </view>

  <!-- 错误提示 -->
  <view class="error" wx:if="{{error}}">
    <text>{{error}}</text>
    <button class="btn-primary" bindtap="retry">重试</button>
  </view>
</view>
