<!--pages/community/post/create/create.wxml-->
<view class="container">
  <view class="create-form card">
    <view class="form-title">发布帖子</view>

    <!-- 分类选择 -->
    <view class="form-item">
      <text class="form-label">分类 <text class="required">*</text></text>
      <picker mode="selector"
              range="{{categoryOptions}}"
              range-key="label"
              value="{{categoryIndex}}"
              bindchange="onCategoryChange">
        <view class="form-picker {{categoryIndex >= 0 ? '' : 'placeholder'}}">
          {{categoryIndex >= 0 ? categoryOptions[categoryIndex].label : '请选择分类'}}
        </view>
      </picker>
    </view>

    <!-- 标题 -->
    <view class="form-item">
      <text class="form-label">标题 <text class="required">*</text></text>
      <input class="form-input"
             placeholder="请输入标题"
             value="{{formData.title}}"
             bindinput="onTitleInput"
             maxlength="50" />
      <text class="input-count">{{formData.title.length}}/50</text>
    </view>

    <!-- 内容 -->
    <view class="form-item">
      <text class="form-label">内容 <text class="required">*</text></text>
      <textarea class="form-textarea"
                placeholder="分享你的想法..."
                value="{{formData.content}}"
                bindinput="onContentInput"
                maxlength="1000"
                auto-height />
      <text class="input-count">{{formData.content.length}}/1000</text>
    </view>

    <!-- 图片上传 -->
    <view class="form-item">
      <text class="form-label">图片（最多9张）</text>
      <view class="image-upload">
        <view class="image-item" wx:for="{{images}}" wx:key="index">
          <image class="upload-image" src="{{item}}" mode="aspectFill"></image>
          <view class="image-delete" data-index="{{index}}" bindtap="deleteImage">×</view>
        </view>
        <view class="image-add" wx:if="{{images.length < 9}}" bindtap="chooseImage">
          <text class="add-icon">+</text>
          <text class="add-text">添加图片</text>
        </view>
      </view>
    </view>

    <!-- 操作按钮 -->
    <view class="form-actions">
      <button class="btn-cancel" bindtap="cancel">取消</button>
      <button class="btn-submit btn-primary" bindtap="submit">发布</button>
    </view>
  </view>

  <!-- 加载遮罩 -->
  <view class="loading-modal" wx:if="{{loading}}">
    <view class="loading-content">
      <text>{{loadingText}}</text>
    </view>
  </view>
</view>
