<!--pages/community/post/list/list.wxml-->
<view class="container">
  <!-- åˆ†ç±»æ ‡ç­¾ -->
  <view class="category-tabs">
    <scroll-view class="tabs-scroll" scroll-x>
      <view class="tab-item {{activeCategory === item.value ? 'active' : ''}}"
            wx:for="{{categories}}"
            wx:key="value"
            data-value="{{item.value}}"
            bindtap="selectCategory">
        <text>{{item.label}}</text>
      </view>
    </scroll-view>
  </view>

  <!-- å¸–å­åˆ—è¡¨ -->
  <view class="post-list">
    <view class="post-item card" 
          wx:for="{{posts}}" 
          wx:key="id"
          data-id="{{item.id}}"
          data-index="{{index}}">
      <!-- å¸–å­å¤´éƒ¨ -->
      <view class="post-header" bindtap="goToPostDetail">
        <image class="author-avatar" src="{{item.authorAvatar}}" mode="aspectFill"></image>
        <view class="author-info">
          <text class="author-name">{{item.authorName}}</text>
          <text class="post-time">{{item.createTime}}</text>
        </view>
        <text class="post-category">{{item.category}}</text>
      </view>

      <!-- å¸–å­å†…å®¹ -->
      <view class="post-content" bindtap="goToPostDetail">
        <text class="post-title">{{item.title}}</text>
        <text class="post-text">{{item.content}}</text>
        
        <!-- å›¾ç‰‡åˆ—è¡¨ -->
        <view class="post-images" wx:if="{{item.images}}">
          <image class="post-image {{item.images.split(',').length === 1 ? 'single' : ''}}"
                 wx:for="{{item.images.split(',')}}"
                 wx:key="index"
                 wx:for-item="img"
                 src="{{img}}"
                 mode="aspectFill"
                 data-urls="{{item.images}}"
                 data-current="{{img}}"
                 catchtap="previewImage">
          </image>
        </view>
      </view>

      <!-- å¸–å­åº•éƒ¨ -->
      <view class="post-footer">
        <view class="post-stats">
          <text class="stat-item">
            <text class="icon">ğŸ‘</text> {{item.views || 0}}
          </text>
          <text class="stat-item" data-id="{{item.id}}" catchtap="goToPostDetail">
            <text class="icon">ğŸ’¬</text> {{item.comments || 0}}
          </text>
        </view>
        <view class="post-action" data-id="{{item.id}}" data-index="{{index}}" catchtap="likePost">
          <text class="icon {{item.liked ? 'liked' : ''}}">{{item.liked ? 'â¤ï¸' : 'ğŸ¤'}}</text>
          <text>{{item.likes || 0}}</text>
        </view>
      </view>
    </view>
  </view>

  <!-- ç©ºçŠ¶æ€ -->
  <view class="empty" wx:if="{{!loading && posts.length === 0}}">
    <image class="empty-image" src="/images/empty.png"></image>
    <text class="empty-text">æš‚æ— å¸–å­</text>
  </view>

  <!-- åŠ è½½æ›´å¤š -->
  <view class="load-more" wx:if="{{hasMore && !loading}}">
    <text bindtap="loadMore">åŠ è½½æ›´å¤š</text>
  </view>

  <!-- åŠ è½½çŠ¶æ€ -->
  <view class="loading" wx:if="{{loading}}">
    <text>åŠ è½½ä¸­...</text>
  </view>

  <!-- å‘å¸ƒæŒ‰é’® -->
  <view class="float-btn" bindtap="createPost">
    <text>+</text>
  </view>
</view>
