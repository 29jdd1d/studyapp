<!--pages/community/post/detail/detail.wxml-->
<view class="container">
  <view class="post-detail" wx:if="{{post}}">
    <!-- å¸–å­å¡ç‰‡ -->
    <view class="post-card card">
      <!-- ä½œè€…ä¿¡æ¯ -->
      <view class="author-section">
        <image class="author-avatar" src="{{post.authorAvatar}}" mode="aspectFill"></image>
        <view class="author-info">
          <text class="author-name">{{post.authorName}}</text>
          <text class="post-time">{{post.createTime}}</text>
        </view>
        <text class="post-category">{{post.category}}</text>
      </view>

      <!-- å¸–å­æ ‡é¢˜ -->
      <text class="post-title">{{post.title}}</text>

      <!-- å¸–å­å†…å®¹ -->
      <text class="post-content">{{post.content}}</text>

      <!-- å›¾ç‰‡åˆ—è¡¨ -->
      <view class="post-images" wx:if="{{post.images}}">
        <image class="post-image {{post.images.split(',').length === 1 ? 'single' : ''}}"
               wx:for="{{post.images.split(',')}}"
               wx:key="index"
               wx:for-item="img"
               src="{{img}}"
               mode="aspectFill"
               data-urls="{{post.images}}"
               data-current="{{img}}"
               bindtap="previewImage">
        </image>
      </view>

      <!-- å¸–å­ç»Ÿè®¡ -->
      <view class="post-stats">
        <text class="stat-item">
          <text class="icon">ğŸ‘</text> {{post.views || 0}} æµè§ˆ
        </text>
        <text class="stat-item">
          <text class="icon">ğŸ’¬</text> {{post.comments || 0}} è¯„è®º
        </text>
        <view class="like-action" bindtap="likePost">
          <text class="icon {{post.liked ? 'liked' : ''}}">{{post.liked ? 'â¤ï¸' : 'ğŸ¤'}}</text>
          <text>{{post.likes || 0}}</text>
        </view>
      </view>
    </view>

    <!-- è¯„è®ºåˆ—è¡¨ -->
    <view class="comments-card card">
      <view class="card-title">è¯„è®º ({{comments.length}})</view>

      <view class="comments-list" wx:if="{{comments.length > 0}}">
        <view class="comment-item" wx:for="{{comments}}" wx:key="id">
          <image class="comment-avatar" src="{{item.userAvatar}}" mode="aspectFill"></image>
          <view class="comment-content">
            <view class="comment-header">
              <text class="comment-user">{{item.userName}}</text>
              <text class="comment-time">{{item.createTime}}</text>
            </view>
            <text class="comment-text">{{item.content}}</text>
          </view>
        </view>
      </view>

      <view class="empty-comments" wx:else>
        <text>è¿˜æ²¡æœ‰è¯„è®ºï¼Œå¿«æ¥æŠ¢æ²™å‘~</text>
      </view>
    </view>
  </view>

  <!-- åŠ è½½çŠ¶æ€ -->
  <view class="loading" wx:if="{{loading}}">
    <text>åŠ è½½ä¸­...</text>
  </view>

  <!-- é”™è¯¯æç¤º -->
  <view class="error" wx:if="{{error}}">
    <text>{{error}}</text>
    <button class="btn-primary" bindtap="retry">é‡è¯•</button>
  </view>

  <!-- åº•éƒ¨è¯„è®ºè¾“å…¥æ¡† -->
  <view class="comment-input-bar" wx:if="{{post}}">
    <input class="comment-input"
           placeholder="è¯´è¯´ä½ çš„æƒ³æ³•..."
           value="{{commentText}}"
           bindinput="onCommentInput"
           confirm-type="send"
           bindconfirm="submitComment" />
    <button class="btn-send" bindtap="submitComment">å‘é€</button>
  </view>
</view>
